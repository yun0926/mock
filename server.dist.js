!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("body-parser"),require("cors"),require("express"),require("fs"),require("iconv-lite"),require("log4js"),require("mockjs"),require("path")):"function"==typeof define&&define.amd?define("server",["body-parser","cors","express","fs","iconv-lite","log4js","mockjs","path"],e):"object"==typeof exports?exports.server=e(require("body-parser"),require("cors"),require("express"),require("fs"),require("iconv-lite"),require("log4js"),require("mockjs"),require("path")):t.server=e(t["body-parser"],t.cors,t.express,t.fs,t["iconv-lite"],t.log4js,t.mockjs,t.path)}(this,function(t,e,r,n,o,i,a,u){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r={};return e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=47)}([function(t,e){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,e,r){t.exports=!r(2)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,r){var n=r(24);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){var r=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:r)(t)}},function(t,e,r){var n=r(6),o=r(5);t.exports=function(t){return n(o(t))}},function(t,e,r){t.exports={default:r(19),__esModule:!0}},function(t,e,r){t.exports={default:r(20),__esModule:!0}},function(t,e){t.exports=require("body-parser")},function(t,e){t.exports=require("cors")},function(t,e){t.exports=require("express")},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("iconv-lite")},function(t,e){t.exports=require("log4js")},function(t,e){t.exports=require("mockjs")},function(t,e){t.exports=require("path")},function(t,e,r){var n=r(0),o=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(t){return o.stringify.apply(o,arguments)}},function(t,e,r){r(46),t.exports=r(0).Object.assign},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,r){var n=r(4);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e,r){var n=r(8),o=r(42),i=r(41);t.exports=function(t){return function(e,r,a){var u,s=n(e),c=o(s.length),f=i(a,c);if(t&&r!=r){for(;c>f;)if((u=s[f++])!=u)return!0}else for(;c>f;f++)if((t||f in s)&&s[f]===r)return t||f||0;return!t&&-1}}},function(t,e){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,e,r){var n=r(21);t.exports=function(t,e,r){if(n(t),void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)}}return function(){return t.apply(e,arguments)}}},function(t,e,r){var n=r(4),o=r(3).document,i=n(o)&&n(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,r){var n=r(3),o=r(0),i=r(25),a=r(30),u="prototype",s=function(t,e,r){var c,f,l,p=t&s.F,h=t&s.G,d=t&s.S,y=t&s.P,g=t&s.B,v=t&s.W,m=h?o:o[e]||(o[e]={}),x=m[u],b=h?n:d?n[e]:(n[e]||{})[u];h&&(r=e);for(c in r)(f=!p&&b&&void 0!==b[c])&&c in m||(l=f?b[c]:r[c],m[c]=h&&"function"!=typeof b[c]?r[c]:g&&f?i(l,n):v&&b[c]==l?function(t){var e=function(e,r,n){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,r)}return new t(e,r,n)}return t.apply(this,arguments)};return e[u]=t[u],e}(l):y&&"function"==typeof l?i(Function.call,l):l,y&&((m.virtual||(m.virtual={}))[c]=l,t&s.R&&x&&!x[c]&&a(x,c,l)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,t.exports=s},function(t,e){var r={}.hasOwnProperty;t.exports=function(t,e){return r.call(t,e)}},function(t,e,r){var n=r(33),o=r(38);t.exports=r(1)?function(t,e,r){return n.f(t,e,o(1,r))}:function(t,e,r){return t[e]=r,t}},function(t,e,r){t.exports=!r(1)&&!r(2)(function(){return 7!=Object.defineProperty(r(26)("div"),"a",{get:function(){return 7}}).a})},function(t,e,r){"use strict";var n=r(36),o=r(34),i=r(37),a=r(43),u=r(6),s=Object.assign;t.exports=!s||r(2)(function(){var t={},e={},r=Symbol(),n="abcdefghijklmnopqrst";return t[r]=7,n.split("").forEach(function(t){e[t]=t}),7!=s({},t)[r]||Object.keys(s({},e)).join("")!=n})?function(t,e){for(var r=a(t),s=arguments.length,c=1,f=o.f,l=i.f;s>c;)for(var p,h=u(arguments[c++]),d=f?n(h).concat(f(h)):n(h),y=d.length,g=0;y>g;)l.call(h,p=d[g++])&&(r[p]=h[p]);return r}:s},function(t,e,r){var n=r(22),o=r(31),i=r(44),a=Object.defineProperty;e.f=r(1)?Object.defineProperty:function(t,e,r){if(n(t),e=i(e,!0),n(r),o)try{return a(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[e]=r.value),t}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,r){var n=r(29),o=r(8),i=r(23)(!1),a=r(39)("IE_PROTO");t.exports=function(t,e){var r,u=o(t),s=0,c=[];for(r in u)r!=a&&n(u,r)&&c.push(r);for(;e.length>s;)n(u,r=e[s++])&&(~i(c,r)||c.push(r));return c}},function(t,e,r){var n=r(35),o=r(27);t.exports=Object.keys||function(t){return n(t,o)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,r){var n=r(40)("keys"),o=r(45);t.exports=function(t){return n[t]||(n[t]=o(t))}},function(t,e,r){var n=r(3),o="__core-js_shared__",i=n[o]||(n[o]={});t.exports=function(t){return i[t]||(i[t]={})}},function(t,e,r){var n=r(7),o=Math.max,i=Math.min;t.exports=function(t,e){return t=n(t),t<0?o(t+e,0):i(t,e)}},function(t,e,r){var n=r(7),o=Math.min;t.exports=function(t){return t>0?o(n(t),9007199254740991):0}},function(t,e,r){var n=r(5);t.exports=function(t){return Object(n(t))}},function(t,e,r){var n=r(4);t.exports=function(t,e){if(!n(t))return t;var r,o;if(e&&"function"==typeof(r=t.toString)&&!n(o=r.call(t)))return o;if("function"==typeof(r=t.valueOf)&&!n(o=r.call(t)))return o;if(!e&&"function"==typeof(r=t.toString)&&!n(o=r.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e){var r=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+n).toString(36))}},function(t,e,r){var n=r(28);n(n.S+n.F,"Object",{assign:r(32)})},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t){(0,s.default)(this,o.defaults,t),this.app=new f.default,console.log(m.default.join(__dirname,"aaa")),this.cacheDataPath=__dirname+m.default.sep+this.projectName+"_"+this.cacheDataPatchAnchor,this.backTitmeFilePath=this.cacheDataPath+m.default.sep+this.bakJsonFileName,this.initLog(),this.initProjectInitFile()}Object.defineProperty(e,"__esModule",{value:!0}),e.SystemLog=e.MyServer=void 0;var i=r(9),a=n(i),u=r(10),s=n(u),c=r(13),f=n(c),l=r(17),p=n(l),h=r(11),d=n(h),y=r(14),g=n(y),v=r(18),m=n(v),x=r(15),b=n(x),j=r(12),w=n(j),S=r(16),_=n(S);_.default.configure({appenders:[{type:"file",filename:"log/system.log",category:"system"}]});var O=_.default.getLogger("system");O.setLevel("ERROR"),o.prototype.initLog=function(){_.default.addAppender(_.default.appenders.file("log"+m.default.sep+this.projectName+".log"),this.projectName),this.logger=_.default.getLogger(this.projectName),this.logger.setLevel(this.logLevel),this.app.use(_.default.connectLogger(this.logger,{level:"auto"}))},o.prototype.initProjectInitFile=function(){if(g.default.existsSync(this.backTitmeFilePath)){console.log("---------找到备份文件 备份文件 start--------");var t=g.default.createReadStream(this.backTitmeFilePath),e=g.default.createWriteStream(this.cacheDataPath+m.default.sep+(new Date).getTime()+".json");t.pipe(e),t.on("end",function(){console.log("copy end"),this.deleteFileToCreactFile(),this.startServer()}.bind(this)),t.on("error",function(){console.log("copy error")}.bind(this))}else console.log("------没有找到备份文件 项目第一次启动 开始创建文件 start------"),this.deleteFileToCreactFile(),this.startServer(),console.log("------end------")},o.prototype.deleteFileToCreactFile=function(){var t=this.cacheDataPath;g.default.existsSync(t)?(console.log(t+"\n已经有该目录\n"),this.writeFile()):(g.default.mkdirSync(t),console.log("更新目录已创建成功\n"+t),this.writeFile()),this.readFileSyncToCacheData()},o.prototype.writeFile=function(){var t=this.cacheDataPath+m.default.sep+this.cacheDatafileName,e="{}";g.default.existsSync(this.backTitmeFilePath)&&(e=g.default.readFileSync(this.backTitmeFilePath,"utf-8"));var r=b.default.encode(e,"utf8");g.default.writeFileSync(t,r,"utf-8")},o.prototype.readFileSyncToCacheData=function(){var t=this.cacheDataPath+m.default.sep+this.cacheDatafileName,e=g.default.readFileSync(t,"utf-8"),r=JSON.parse(e);return this.Mdata=r,!0},o.prototype.corsInit=function(){var t={origin:this.origin,optionsSuccessStatus:200};this.app.use((0,w.default)(t))},o.prototype.startServer=function(){this.corsInit(),this.app.use(f.default.static(__dirname+"/Mock",{index:"index.html"})),this.app.use(f.default.static(this.cacheDataPath)),this.app.use(d.default.urlencoded({extended:!1})),this.app.use(d.default.json());for(var t in this.Mdata)this.helpReg(t);this.initRoute(),this.app.listen(this.listenPort),console.log("----startServer----------"),console.log(this.Mdata)},o.prototype.helpReg=function(t){var e=this,r=function(t,r,n){var o=t.url.replace(/\?.*/i,""),i=e.Mdata[o].sleep,a=e.Mdata[o].data;a.query=t.query||{},i>0?setTimeout(function(){r.send(p.default.mock(a))},1e3*i):r.send(p.default.mock(a))};this.app.route(t).get(r).post(r)},o.prototype.initRoute=function(){this.app.route("/lux/test").get(function(t,e){var r=t.query,n=r.url,n=(r.ctx,r.sleep,r.msg,r.isover,n.replace(/\?.*/i,"")),o=this.Mdata[n]?this.Mdata[n].data:{msg:n+": 可以使用"};e.send(o)}.bind(this)),this.app.route("/lux/data").post(function(t,e){var r,n,o=t.body,i=o.url,u=o.ctx,s=o.sleep,c=o.msg,f=o.isover,i=i.replace(/\?.*/i,"").toLowerCase(),l=new Date;try{if(!/^\//.test(i))throw new Error('url 地址必需以 "/" 开头,比如: /public/getEnum');if(!/^[\/\w\.]+$/.test(i))throw new Error("请输入正确的url");if(r=JSON.parse(u),/^[1-9]\d{0,1}$/.test(s)||(s=0),n={msg:c||"暂无备注",sleep:Number(s),at:l.toLocaleString()+" "+l.toLocaleTimeString(),data:r},this.Mdata[i]){if("true"!==f)throw new Error("已经存在了该请求的url的内容,请检查内容后选择是否进行覆盖");this.Mdata[i]=n}else this.Mdata[i]=n;this.helpReg(i),g.default.writeFile(this.backTitmeFilePath,(0,a.default)(this.Mdata),"utf8")}catch(t){r={msg:t.message||'上传错误，检查您的json是否为标准的"json'}}e.send(r)}.bind(this))},o.defaults={origin:"*",projectName:"eworkpal",cacheDataPatchAnchor:"database_file",cacheDatafileName:"web_mock.json",bakJsonFileName:"web_mock_bak.json",mock_file_url:"mock_file",listenPort:9092,logLevel:"ERROR"},e.MyServer=o,e.SystemLog=O}])});